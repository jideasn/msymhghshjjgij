<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="market">


<select id="marketList" parameterType="pageNumber" resultType="market">
	<![CDATA[
		select * from 
			(select rownum rnum, market_no,
			market_title,market_releasedate,market_note,market_img,
			member_id from (select * from market order by 
			market_no desc)) where rnum >= #{startRow} and rnum <= #{endRow}
	]]>
</select>
	
	<select id="marketInfo" parameterType="int" resultType="market">
	<![CDATA[
		select * from market where market_no =#{market_no}
	]]>
	
	</select>
	
	<select id="reviewList" parameterType="pageNumber" resultType="Review">
	<![CDATA[
		select * from (select rownum rnum, review_no,review_title,member_id,review_date from review where market_no =#{market_no}
		order by review_no desc) where rnum>= #{startRow} and rnum <=#{endRow}
	]]>
	</select>
	
	<select id="reviewCount" parameterType="int" resultType="int" >
	 <![CDATA[
	 select count(*) from review where market_no = #{market_no}
	 ]]>
	</select>
	<select id="reviewDetail" parameterType="int" resultType="Review">
		select * from review where review_no = #{review_no}
	</select>

<insert id="insertMarket" parameterType="Market" flushCache="true" useGeneratedKeys="true">
	<![CDATA[
		insert into market values((select max(market_no) from market)+1,1,#{member_id},#{market_title},#{market_note},#{market_img},
		#{market_releasedate},#{market_amount},#{market_intro},'0',#{market_price})
	]]>
	</insert>
	
	
	<insert id="insertMarket_qna" parameterType="market_qna" flushCache="true" useGeneratedKeys="true">
	<![CDATA[
		insert into market_qna values((select max(market_qna_no) from market_qna)+1,#{market_no},#{member_id},sysdate,null,null,#{market_qna_title},#{market_qna_contents}
		,1)
	]]>
	</insert>
	
	<insert id="insertReview" parameterType="review" flushCache="true" useGeneratedKeys="true">
	<![CDATA[
		insert into review values((select max(review_no) from review)+1,#{member_id},#{market_no},sysdate,#{review_title},#{review_contents}
		)
	]]>
	</insert>
	<select id="dailyList" parameterType="int" resultType="Daily">
	<![CDATA[
		select * from daily where market_no = #{market_no} order by daily_no desc
	]]>
	</select>
	<insert id="insertMarketDaily" parameterType="Daily" flushCache="true" useGeneratedKeys="true">
		<![CDATA[
		insert into daily values((select max(daily_no) from daily)+1,#{market_no},sysdate,#{daily_title},#{daily_contents}
		)
	]]>
	</insert>
	
	<select id="selectHomeNewMarketList" resultType="market">
	<![CDATA[
		select * from(select rownum rnum,market_no,category_no,member_id,
		market_title,market_note,market_img,market_releasedate,market_amount,
		market_intro,market_complete,market_price from market order by market_no desc) market where rnum>=1 and rnum<=2 
	]]>
	</select>
	
	<select id="selectHomePopularMarketList" resultType="market">
	<![CDATA[
		select * from market where market_no in ((select market_no from(select market_no,rownum rnum from(select count(*), market_no from buy 
		group by market_no order by count(*) desc))where rnum>=1 and rnum<=4))
	]]>
	</select>
	
	<select id="dailyDetail" parameterType="int" resultType="Daily">
		select * from daily where daily_no = #{daily_no}
	</select>
</mapper>
